<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>JTM Shop - Order Search (Enhanced)</title>
  <style>
    body { 
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans Thai", sans-serif; 
      margin: 0; 
      padding: 24px; 
      line-height: 1.5; 
      background-color: #f8fafc;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      background-color: white;
      padding: 32px;
      border-radius: 16px;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    }
    h1 { margin-bottom: 8px; color: #1f2937; }
    .search-section {
      background-color: #f9fafb;
      padding: 24px;
      border-radius: 12px;
      margin-bottom: 24px;
      border: 1px solid #e5e7eb;
    }
    .search-row {
      display: flex;
      gap: 16px;
      align-items: end;
      margin-bottom: 16px;
    }
    .search-group {
      flex: 1;
    }
    label { 
      display: block; 
      font-weight: 600; 
      margin-bottom: 6px; 
      color: #374151;
    }
    input[type="text"], select { 
      width: 100%; 
      padding: 10px; 
      border: 1px solid #cbd5e1; 
      border-radius: 8px; 
      font-size: 14px;
    }
    button { 
      padding: 12px 24px; 
      border-radius: 8px; 
      border: 0; 
      background: #111827; 
      color: #fff; 
      cursor: pointer; 
      font-weight: 600;
      transition: background-color 0.2s;
    }
    button:hover {
      background: #1f2937;
    }
    button:disabled { 
      opacity: 0.6; 
      cursor: not-allowed; 
    }
    .loading {
      text-align: center;
      padding: 40px;
      color: #6b7280;
    }
    .error {
      color: #dc2626;
      background-color: #fef2f2;
      padding: 12px;
      border-radius: 8px;
      border: 1px solid #fecaca;
      margin-bottom: 16px;
    }
    .success {
      color: #059669;
      background-color: #f0fdf4;
      padding: 12px;
      border-radius: 8px;
      border: 1px solid #bbf7d0;
      margin-bottom: 16px;
    }
    .order-card {
      border: 1px solid #e5e7eb;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 16px;
      background-color: white;
    }
    .order-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
      padding-bottom: 12px;
      border-bottom: 1px solid #e5e7eb;
    }
    .order-info {
      flex: 1;
    }
    .order-name {
      font-size: 18px;
      font-weight: 700;
      color: #1f2937;
      margin-bottom: 4px;
    }
    .order-details {
      color: #6b7280;
      font-size: 14px;
    }
    .order-total {
      font-size: 20px;
      font-weight: 700;
      color: #059669;
    }
    .core-team-badge {
      background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
      color: white;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-left: 12px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    .order-items {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 16px;
    }
    .item-card {
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      padding: 16px;
      background-color: #f9fafb;
    }
    .item-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 12px;
    }
    .item-image {
      width: 60px;
      height: 60px;
      object-fit: cover;
      border-radius: 8px;
      border: 1px solid #e5e7eb;
    }
    .item-info {
      flex: 1;
    }
    .item-name {
      font-weight: 600;
      color: #374151;
      margin-bottom: 4px;
      font-size: 14px;
    }
    .item-quantity {
      color: #059669;
      font-weight: 600;
      font-size: 16px;
    }
    .no-results {
      text-align: center;
      padding: 40px;
      color: #6b7280;
      font-style: italic;
    }


    
    @media (max-width: 768px) {
      body { padding: 16px; }
      .container { padding: 20px; }
      .search-row { flex-direction: column; }
      .order-header { flex-direction: column; align-items: flex-start; gap: 8px; }
      .order-items { grid-template-columns: 1fr; }
      .stats { flex-direction: column; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üîç JTM Shop - Order Search (Enhanced)</h1>
    <p style="color: #6b7280; margin-bottom: 24px;">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏à‡∏≤‡∏Å Google Sheets - Order Data Tab - ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á</p>

    <!-- Search Section -->
    <div class="search-section">
      <div class="search-row">
        <div class="search-group">
          <label for="batchFilter">‡∏£‡∏∏‡πà‡∏ô (Batch)</label>
          <select id="batchFilter">
            <option value="">‡∏ó‡∏∏‡∏Å‡∏£‡∏∏‡πà‡∏ô</option>
            <option value="JTM#18">JTM#18</option>
            <option value="JTM#19">JTM#19</option>
            <option value="JTM#20">JTM#20</option>
            <option value="JTM#21">JTM#21</option>
            <option value="JTM#22">JTM#22</option>
            <option value="JTM#23">JTM#23</option>
            <option value="JTM#24">JTM#24</option>
            <option value="JTM#25">JTM#25</option>
            <option value="JTM#26">JTM#26</option>
            <option value="JTM#27">JTM#27</option>
            <option value="‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏£‡∏π">‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏£‡∏π</option>
            <option value="‡∏≠‡∏∑‡πà‡∏ô‡πÜ">‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
          </select>
        </div>
        <div class="search-group">
          <label for="nameSearch">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠</label>
          <input id="nameSearch" type="text" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤..." />
        </div>
        <div class="search-group">
          <button id="searchBtn" onclick="searchOrders()">üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>
        </div>
      </div>
      <div class="search-row">
        <div class="search-group">
          <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
            <input type="checkbox" id="coreTeamFilter" style="width: auto; margin: 0;">
            ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞ Core Team (‡∏ï‡∏¥‡∏î‡∏•‡∏ö)
          </label>
        </div>
        <div class="search-group">
          <button id="clearBtn" onclick="clearSearch()">üóëÔ∏è ‡∏•‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>
        </div>
      </div>
    </div>

    <!-- Status Messages -->
    <div id="statusMessage"></div>



    <!-- Results Section -->
    <div id="resultsSection"></div>
  </div>

  <script>
    // Google Sheets URL - you need to publish this as CSV
    // To publish: File > Share > Publish to web > CSV
    // Reading from "Order Data" tab instead of main sheet
    const SHEETS_URL = "https://docs.google.com/spreadsheets/d/19RzNl-aSOvQ0DRSAo4pjm3YcF4FdEqPl37rOtmu8CIY/edit?gid=2144844534#gid=2144844534";
    
    // CORS Proxy (you can use any of these or set up your own)
    const CORS_PROXIES = [
      "https://cors-anywhere.herokuapp.com/",
      "https://api.allorigins.win/raw?url=",
      "https://corsproxy.io/?",
      "https://thingproxy.freeboard.io/fetch/"
    ];
    
    // Product catalog with images
    const PRODUCT_CATALOG = [
      { name: "‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏¢‡∏∏‡∏á‡∏•‡∏≤‡∏¢‡∏ó‡∏£‡∏á Standard ‡∏õ‡∏±‡∏Å‡πÇ‡∏•‡πÇ‡∏Å‡πâ - ‡∏ú‡∏π‡πâ‡πÉ‡∏´‡∏ç‡πà Deep Navy S", image: "standard.png", price: 300 },
      { name: "‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏¢‡∏∏‡∏á‡∏•‡∏≤‡∏¢‡∏ó‡∏£‡∏á Standard ‡∏õ‡∏±‡∏Å‡πÇ‡∏•‡πÇ‡∏Å‡πâ - ‡∏ú‡∏π‡πâ‡πÉ‡∏´‡∏ç‡πà Deep Navy M", image: "standard.png", price: 300 },
      { name: "‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏¢‡∏∏‡∏á‡∏•‡∏≤‡∏¢‡∏ó‡∏£‡∏á Standard ‡∏õ‡∏±‡∏Å‡πÇ‡∏•‡πÇ‡∏Å‡πâ - ‡∏ú‡∏π‡πâ‡πÉ‡∏´‡∏ç‡πà Deep Navy L", image: "standard.png", price: 300 },
      { name: "‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏¢‡∏∏‡∏á‡∏•‡∏≤‡∏¢‡∏ó‡∏£‡∏á Standard ‡∏õ‡∏±‡∏Å‡πÇ‡∏•‡πÇ‡∏Å‡πâ - ‡∏ú‡∏π‡πâ‡πÉ‡∏´‡∏ç‡πà Deep Navy XL", image: "standard.png", price: 300 },
      { name: "‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏¢‡∏∏‡∏á‡∏•‡∏≤‡∏¢‡∏ó‡∏£‡∏á Standard ‡∏õ‡∏±‡∏Å‡πÇ‡∏•‡πÇ‡∏Å‡πâ - ‡∏ú‡∏π‡πâ‡πÉ‡∏´‡∏ç‡πà Deep Navy 2XL", image: "standard.png", price: 300 },
      { name: "‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏¢‡∏∏‡∏á‡∏•‡∏≤‡∏¢‡∏ó‡∏£‡∏á Standard ‡∏õ‡∏±‡∏Å‡πÇ‡∏•‡πÇ‡∏Å‡πâ - ‡∏ú‡∏π‡πâ‡πÉ‡∏´‡∏ç‡πà White S", image: "standard.png", price: 300 },
      { name: "‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏¢‡∏∏‡∏á‡∏•‡∏≤‡∏¢‡∏ó‡∏£‡∏á Standard ‡∏õ‡∏±‡∏Å‡πÇ‡∏•‡πÇ‡∏Å‡πâ - ‡∏ú‡∏π‡πâ‡πÉ‡∏´‡∏ç‡πà White M", image: "standard.png", price: 300 },
      { name: "‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏¢‡∏∏‡∏á‡∏•‡∏≤‡∏¢‡∏ó‡∏£‡∏á Standard ‡∏õ‡∏±‡∏Å‡πÇ‡∏•‡πÇ‡∏Å‡πâ - ‡∏ú‡∏π‡πâ‡πÉ‡∏´‡∏ç‡πà White L", image: "standard.png", price: 300 },
      { name: "‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏¢‡∏∏‡∏á‡∏•‡∏≤‡∏¢‡∏ó‡∏£‡∏á Standard ‡∏õ‡∏±‡∏Å‡πÇ‡∏•‡πÇ‡∏Å‡πâ - ‡∏ú‡∏π‡πâ‡πÉ‡∏´‡∏ç‡πà White XL", image: "standard.png", price: 300 },
      { name: "‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏¢‡∏∏‡∏á‡∏•‡∏≤‡∏¢‡∏ó‡∏£‡∏á Standard ‡∏õ‡∏±‡∏Å‡πÇ‡∏•‡πÇ‡∏Å‡πâ - ‡∏ú‡∏π‡πâ‡πÉ‡∏´‡∏ç‡πà White 2XL", image: "standard.png", price: 300 },
      { name: "‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏¢‡∏∏‡∏á‡∏•‡∏≤‡∏¢‡∏ó‡∏£‡∏á Oversize ‡∏õ‡∏±‡∏Å‡πÇ‡∏•‡πÇ‡∏Å‡πâ - ‡∏ú‡∏π‡πâ‡πÉ‡∏´‡∏ç‡πà Female 45'' Deep Navy", image: "oversize.png", price: 350 },
      { name: "‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏¢‡∏∏‡∏á‡∏•‡∏≤‡∏¢‡∏ó‡∏£‡∏á Oversize ‡∏õ‡∏±‡∏Å‡πÇ‡∏•‡πÇ‡∏Å‡πâ - ‡∏ú‡∏π‡πâ‡πÉ‡∏´‡∏ç‡πà Male 50'' Deep Navy", image: "oversize.png", price: 350 },
      { name: "‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏¢‡∏∏‡∏á‡∏•‡∏≤‡∏¢‡∏ó‡∏£‡∏á Oversize ‡∏õ‡∏±‡∏Å‡πÇ‡∏•‡πÇ‡∏Å‡πâ - ‡∏ú‡∏π‡πâ‡πÉ‡∏´‡∏ç‡πà Female 45'' White", image: "oversize.png", price: 350 },
      { name: "‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏¢‡∏∏‡∏á‡∏•‡∏≤‡∏¢‡∏ó‡∏£‡∏á Oversize ‡∏õ‡∏±‡∏Å‡πÇ‡∏•‡πÇ‡∏Å‡πâ - ‡∏ú‡∏π‡πâ‡πÉ‡∏´‡∏ç‡πà Male 50'' White", image: "oversize.png", price: 350 },
      { name: "‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏¢‡∏∏‡∏á‡∏•‡∏≤‡∏¢‡∏õ‡∏±‡∏Å‡πÇ‡∏•‡πÇ‡∏Å‡πâ ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏î‡πá‡∏Å 110", image: "kids.jpg", price: 220 },
      { name: "‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏¢‡∏∏‡∏á‡∏•‡∏≤‡∏¢‡∏õ‡∏±‡∏Å‡πÇ‡∏•‡πÇ‡∏Å‡πâ ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏î‡πá‡∏Å 120", image: "kids.jpg", price: 220 },
      { name: "‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏¢‡∏∏‡∏á‡∏•‡∏≤‡∏¢‡∏õ‡∏±‡∏Å‡πÇ‡∏•‡πÇ‡∏Å‡πâ ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏î‡πá‡∏Å 130", image: "kids.jpg", price: 220 },
      { name: "‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏¢‡∏∏‡∏á‡∏•‡∏≤‡∏¢‡∏õ‡∏±‡∏Å‡πÇ‡∏•‡πÇ‡∏Å‡πâ ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏î‡πá‡∏Å 140", image: "kids.jpg", price: 220 },
      { name: "‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏¢‡∏∏‡∏á‡∏•‡∏≤‡∏¢‡∏õ‡∏±‡∏Å‡πÇ‡∏•‡πÇ‡∏Å‡πâ ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏î‡πá‡∏Å 150", image: "kids.jpg", price: 220 },
      { name: "‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤‡∏ú‡πâ‡∏≤‡∏ó‡∏£‡∏á‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏Å‡∏•‡πâ‡∏≤‡∏° ‡∏û‡∏±‡∏ö‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏î‡πâ ‡∏•‡∏≤‡∏¢‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ö‡∏ö‡∏™‡∏∏‡πà‡∏°‡πÅ‡∏ï‡πà‡∏™‡∏ß‡∏¢‡∏ó‡∏∏‡∏Å‡πÉ‡∏ö", image: "bags.jpg", price: 220 },
      { name: "‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤ Cross Body ‡∏™‡∏µ‡∏ü‡πâ‡∏≤", image: "crossbody.jpg", price: 250 },
      { name: "‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤ Cross Body ‡∏™‡∏µ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á", image: "crossbody.jpg", price: 250 },
      { name: "‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤ Cross Body ‡∏™‡∏µ‡∏î‡∏≥", image: "crossbody.jpg", price: 250 },
      { name: "‡∏´‡∏°‡∏ß‡∏Å‡πÅ‡∏Å‡πä‡∏ö‡∏ú‡πâ‡∏≤‡∏£‡πà‡∏° ‡πÄ‡∏î‡πá‡∏Å‡πÉ‡∏™‡πà‡πÑ‡∏î‡πâ ‡∏ú‡∏π‡πâ‡πÉ‡∏´‡∏ç‡πà‡πÉ‡∏™‡πà‡∏î‡∏µ - ‡∏´‡∏°‡∏ß‡∏Å‡πÅ‡∏Å‡πä‡∏õ 3 ‡∏™‡∏µ", image: "hats.jpg", price: 320 },
      { name: "‡∏´‡∏°‡∏ß‡∏Å‡πÅ‡∏Å‡πä‡∏ö‡∏ú‡πâ‡∏≤‡∏£‡πà‡∏° ‡πÄ‡∏î‡πá‡∏Å‡πÉ‡∏™‡πà‡πÑ‡∏î‡πâ ‡∏ú‡∏π‡πâ‡πÉ‡∏´‡∏ç‡πà‡πÉ‡∏™‡πà‡∏î‡∏µ - ‡∏´‡∏°‡∏ß‡∏Å‡πÅ‡∏Å‡πä‡∏õ‡∏™‡∏µ‡πÄ‡∏ó‡∏≤ - ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á", image: "hats.jpg", price: 320 },
      { name: "‡∏´‡∏°‡∏ß‡∏Å‡πÅ‡∏Å‡πä‡∏ö‡∏ú‡πâ‡∏≤‡∏£‡πà‡∏° ‡πÄ‡∏î‡πá‡∏Å‡πÉ‡∏™‡πà‡πÑ‡∏î‡πâ ‡∏ú‡∏π‡πâ‡πÉ‡∏´‡∏ç‡πà‡πÉ‡∏™‡πà‡∏î‡∏µ - ‡∏´‡∏°‡∏ß‡∏Å‡πÅ‡∏Å‡πä‡∏õ‡∏™‡∏µ‡∏ü‡πâ‡∏≤ - ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß", image: "hats.jpg", price: 320 },
      { name: "‡∏´‡∏°‡∏ß‡∏Å Bucket ‡∏ú‡πâ‡∏≤‡∏£‡πà‡∏°", image: "bucket.jpg", price: 350 },
      { name: "‡∏™‡∏ï‡∏¥‡∏Å‡πÄ‡∏Å‡∏≠‡∏£‡πå‡∏ï‡∏¥‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡∏£‡∏ñ ‡πÅ‡∏ö‡∏ö 1", image: "sticker1.jpg", price: 50 },
      { name: "‡∏™‡∏ï‡∏¥‡∏Å‡πÄ‡∏Å‡∏≠‡∏£‡πå‡∏ï‡∏¥‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡∏£‡∏ñ ‡πÅ‡∏ö‡∏ö 2", image: "sticker2.jpg", price: 50 }
    ];

    let allOrders = [];
    let filteredOrders = [];

    // Convert Google Sheets URL to CSV export URL
    function getCSVUrl(sheetsUrl) {
      // Extract the sheet ID and tab ID from the URL
      const sheetMatch = sheetsUrl.match(/\/spreadsheets\/d\/([a-zA-Z0-9-_]+)/);
      const tabMatch = sheetsUrl.match(/gid=(\d+)/);
      
      if (!sheetMatch) {
        throw new Error('Invalid Google Sheets URL');
      }
      
      const sheetId = sheetMatch[1];
      const tabId = tabMatch ? tabMatch[1] : '0'; // Default to first tab if no gid specified
      
      // Use the specific tab ID for CSV export
      return `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:csv&gid=${tabId}`;
    }

    // Load data from Google Sheets using CORS proxy
    async function loadDataFromSheets() {
      const statusDiv = document.getElementById('statusMessage');
      const resultsDiv = document.getElementById('resultsSection');
      
      statusDiv.innerHTML = '<div class="loading">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Google Sheets...</div>';
      resultsDiv.innerHTML = '';

      try {
        const csvUrl = getCSVUrl(SHEETS_URL);
        let csvData = null;
        
        // Try different CORS proxies
        for (let i = 0; i < CORS_PROXIES.length; i++) {
          try {
            const proxyUrl = CORS_PROXIES[i] + encodeURIComponent(csvUrl);
            console.log(`Trying proxy ${i + 1}: ${CORS_PROXIES[i]}`);
            
            const response = await fetch(proxyUrl, {
              method: 'GET',
              headers: {
                'Accept': 'text/csv,text/plain,*/*'
              }
            });
            
            if (response.ok) {
              csvData = await response.text();
              console.log('Successfully loaded data from proxy:', CORS_PROXIES[i]);
              break;
            }
          } catch (proxyError) {
            console.log(`Proxy ${i + 1} failed:`, proxyError);
            continue;
          }
        }
        
        if (!csvData) {
          throw new Error('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Google Sheets ‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á');
        }
        
        // Parse CSV data
        const orders = parseCSVData(csvData);
        allOrders = orders;
        
        statusDiv.innerHTML = '<div class="success">‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏û‡∏ö‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ ' + allOrders.length + ' ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>';
        
        // Show all orders initially
        displayOrders(allOrders);
        
      } catch (error) {
        console.error('Error loading data:', error);
        statusDiv.innerHTML = '<div class="error">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: ' + error.message + '<br><br>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á...</div>';
        
        // Fallback to sample data
        setTimeout(() => {
          const sampleData = generateSampleData();
          allOrders = sampleData;
          displayOrders(allOrders);
          statusDiv.innerHTML = '<div class="success">‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏û‡∏ö‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ ' + allOrders.length + ' ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>';
        }, 1000);
      }
    }

    // Parse CSV data from Google Sheets
    function parseCSVData(csvText) {
      const lines = csvText.split('\n');
      if (lines.length < 2) {
        throw new Error('‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• CSV ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
      }
      
      // Parse headers (first row)
      const headers = parseCSVRow(lines[0]);
      console.log('CSV Headers:', headers);
      
      const orders = [];
      
      // Parse data rows (skip header)
      for (let i = 1; i < lines.length; i++) {
        const line = lines[i].trim();
        if (!line) continue;
        
        const values = parseCSVRow(line);
        if (values.length < headers.length) continue;
        
        const order = {
          timestamp: values[0] || '',
          contactName: values[1] || '',
          batch: values[2] || '',
          batchOther: values[3] || '',
          phoneNumber: values[4] || '',
          totalBaht: parseFloat(values[5]?.replace(/,/g, '')) || 0,
          freeStickers: parseInt(values[6]) || 0,
          paymentSlipURL: values[7] || '',
          coreTeam: values[values.length - 3] || '', // Core Team column (second to last)
          coreTeamAmount: parseFloat(values[values.length - 2]?.replace(/,/g, '')) || 0, // Core Team amount column
          items: {}
        };
        
        // Parse product quantities (columns 8 onwards)
        for (let j = 8; j < Math.min(headers.length, values.length); j++) {
          const productName = headers[j];
          const quantity = parseInt(values[j]) || 0;
          
          // Filter out non-product columns (totals, summaries, etc.)
          if (quantity > 0 && 
              productName && 
              !productName.toLowerCase().includes('total') &&
              !productName.toLowerCase().includes('summary') &&
              !productName.toLowerCase().includes('‡∏£‡∏ß‡∏°') &&
              !productName.toLowerCase().includes('‡∏¢‡∏≠‡∏î') &&
              !productName.toLowerCase().includes('‡∏à‡∏≥‡∏ô‡∏ß‡∏ô') &&
              productName.trim() !== '') {
            order.items[productName] = quantity;
          }
        }
        
        // Only add orders that have items
        if (Object.keys(order.items).length > 0) {
          orders.push(order);
        }
      }
      
      console.log('Parsed orders:', orders);
      return orders;
    }

    // Parse CSV row (handle quoted values)
    function parseCSVRow(line) {
      const result = [];
      let current = '';
      let inQuotes = false;
      
      for (let i = 0; i < line.length; i++) {
        const char = line[i];
        
        if (char === '"') {
          inQuotes = !inQuotes;
        } else if (char === ',' && !inQuotes) {
          result.push(current.trim());
          current = '';
        } else {
          current += char;
        }
      }
      
      result.push(current.trim());
      return result;
    }

    // Generate sample data as fallback
    function generateSampleData() {
      return [
        {
          timestamp: "8/22/2025 20:07:24",
          contactName: "‡∏≠‡∏•‡∏¥‡∏ã‡∏ã‡πà‡∏≤",
          batch: "JTM#25",
          batchOther: "816368018",
          phoneNumber: "2,190",
          totalBaht: 2190,
          freeStickers: 2,
          paymentSlipURL: "https://drive.google.com/file/d/1LNHzkwJ37uJvc3S9xCK_cw7ickMBHmky/view?usp=drivesdk",
          coreTeam: "Core Team",
          coreTeamAmount: 2190,
          items: {
            "‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏¢‡∏∏‡∏á‡∏•‡∏≤‡∏¢‡∏ó‡∏£‡∏á Standard ‡∏õ‡∏±‡∏Å‡πÇ‡∏•‡πÇ‡∏Å‡πâ - ‡∏ú‡∏π‡πâ‡πÉ‡∏´‡∏ç‡πà Deep Navy L": 1,
            "‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏¢‡∏∏‡∏á‡∏•‡∏≤‡∏¢‡∏ó‡∏£‡∏á Standard ‡∏õ‡∏±‡∏Å‡πÇ‡∏•‡πÇ‡∏Å‡πâ - ‡∏ú‡∏π‡πâ‡πÉ‡∏´‡∏ç‡πà White S": 1,
            "‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏¢‡∏∏‡∏á‡∏•‡∏≤‡∏¢‡∏ó‡∏£‡∏á Oversize ‡∏õ‡∏±‡∏Å‡πÇ‡∏•‡πÇ‡∏Å‡πâ - ‡∏ú‡∏π‡πâ‡πÉ‡∏´‡∏ç‡πà Female 45'' Deep Navy": 1,
            "‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤ Cross Body ‡∏™‡∏µ‡∏ü‡πâ‡∏≤": 1,
            "‡∏´‡∏°‡∏ß‡∏Å‡πÅ‡∏Å‡πä‡∏ö‡∏ú‡πâ‡∏≤‡∏£‡πà‡∏° ‡πÄ‡∏î‡πá‡∏Å‡πÉ‡∏™‡πà‡πÑ‡∏î‡πâ ‡∏ú‡∏π‡πâ‡πÉ‡∏´‡∏ç‡πà‡πÉ‡∏™‡πà‡∏î‡∏µ - ‡∏´‡∏°‡∏ß‡∏Å‡πÅ‡∏Å‡πä‡∏õ 3 ‡∏™‡∏µ": 1,
            "‡∏™‡∏ï‡∏¥‡∏Å‡πÄ‡∏Å‡∏≠‡∏£‡πå‡∏ï‡∏¥‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡∏£‡∏ñ ‡πÅ‡∏ö‡∏ö 1": 1,
            "‡∏™‡∏ï‡∏¥‡∏Å‡πÄ‡∏Å‡∏≠‡∏£‡πå‡∏ï‡∏¥‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡∏£‡∏ñ ‡πÅ‡∏ö‡∏ö 2": 1
          }
        },
        {
          timestamp: "8/22/2025 20:11:31",
          contactName: "‡∏ò‡∏£‡∏£‡∏°‡∏ä‡∏≤‡∏ï‡∏¥",
          batch: "JTM#20",
          batchOther: "819280635",
          phoneNumber: "2,860",
          totalBaht: 2860,
          freeStickers: 2,
          paymentSlipURL: "https://drive.google.com/file/d/1CXIN0vLw8Y7XArbmM0UwiUTnRcjJmyai/view?usp=drivesdk",
          coreTeam: "Core Team",
          coreTeamAmount: -350,
          items: {
            "‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏¢‡∏∏‡∏á‡∏•‡∏≤‡∏¢‡∏ó‡∏£‡∏á Standard ‡∏õ‡∏±‡∏Å‡πÇ‡∏•‡πÇ‡∏Å‡πâ - ‡∏ú‡∏π‡πâ‡πÉ‡∏´‡∏ç‡πà Deep Navy 2XL": 1,
            "‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏¢‡∏∏‡∏á‡∏•‡∏≤‡∏¢‡∏ó‡∏£‡∏á Oversize ‡∏õ‡∏±‡∏Å‡πÇ‡∏•‡πÇ‡∏Å‡πâ - ‡∏ú‡∏π‡πâ‡πÉ‡∏´‡∏ç‡πà Female 45'' White": 1,
            "‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤ Cross Body ‡∏™‡∏µ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á": 1,
            "‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤ Cross Body ‡∏™‡∏µ‡∏î‡∏≥": 1,
            "‡∏´‡∏°‡∏ß‡∏Å‡πÅ‡∏Å‡πä‡∏ö‡∏ú‡πâ‡∏≤‡∏£‡πà‡∏° ‡πÄ‡∏î‡πá‡∏Å‡πÉ‡∏™‡πà‡πÑ‡∏î‡πâ ‡∏ú‡∏π‡πâ‡πÉ‡∏´‡∏ç‡πà‡πÉ‡∏™‡πà‡∏î‡∏µ - ‡∏´‡∏°‡∏ß‡∏Å‡πÅ‡∏Å‡πä‡∏õ‡∏™‡∏µ‡πÄ‡∏ó‡∏≤ - ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á": 1,
            "‡∏´‡∏°‡∏ß‡∏Å‡πÅ‡∏Å‡πä‡∏ö‡∏ú‡πâ‡∏≤‡∏£‡πà‡∏° ‡πÄ‡∏î‡πá‡∏Å‡πÉ‡∏™‡πà‡πÑ‡∏î‡πâ ‡∏ú‡∏π‡πâ‡πÉ‡∏´‡∏ç‡πà‡πÉ‡∏™‡πà‡∏î‡∏µ - ‡∏´‡∏°‡∏ß‡∏Å‡πÅ‡∏Å‡πä‡∏õ‡∏™‡∏µ‡∏ü‡πâ‡∏≤ - ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß": 1,
            "‡∏´‡∏°‡∏ß‡∏Å Bucket ‡∏ú‡πâ‡∏≤‡∏£‡πà‡∏°": 1,
            "‡∏™‡∏ï‡∏¥‡∏Å‡πÄ‡∏Å‡∏≠‡∏£‡πå‡∏ï‡∏¥‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡∏£‡∏ñ ‡πÅ‡∏ö‡∏ö 1": 1,
            "‡∏™‡∏ï‡∏¥‡∏Å‡πÄ‡∏Å‡∏≠‡∏£‡πå‡∏ï‡∏¥‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡∏£‡∏ñ ‡πÅ‡∏ö‡∏ö 2": 1
          }
        },
        {
          timestamp: "8/22/2025 20:12:00",
          contactName: "‡πÑ‡∏ó‡∏°‡πå ‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡∏î‡∏µ",
          batch: "JTM#22",
          batchOther: "867871741",
          phoneNumber: "2,120",
          totalBaht: 2120,
          freeStickers: 2,
          paymentSlipURL: "https://drive.google.com/file/d/1gUdrP0SWuEcDcZN9ZDhyNRrKYcutQcVy/view?usp=drivesdk",
          coreTeam: "",
          coreTeamAmount: 0,
          items: {
            "‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤ Cross Body ‡∏™‡∏µ‡∏î‡∏≥": 1,
            "‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤ Cross Body ‡∏™‡∏µ‡∏ü‡πâ‡∏≤": 1,
            "‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤‡∏ú‡πâ‡∏≤‡∏ó‡∏£‡∏á‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏Å‡∏•‡πâ‡∏≤‡∏° ‡∏û‡∏±‡∏ö‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏î‡πâ ‡∏•‡∏≤‡∏¢‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ö‡∏ö‡∏™‡∏∏‡πà‡∏°‡πÅ‡∏ï‡πà‡∏™‡∏ß‡∏¢‡∏ó‡∏∏‡∏Å‡πÉ‡∏ö": 2,
            "‡∏´‡∏°‡∏ß‡∏Å‡πÅ‡∏Å‡πä‡∏ö‡∏ú‡πâ‡∏≤‡∏£‡πà‡∏° ‡πÄ‡∏î‡πá‡∏Å‡πÉ‡∏™‡πà‡πÑ‡∏î‡πâ ‡∏ú‡∏π‡πâ‡πÉ‡∏´‡∏ç‡πà‡πÉ‡∏™‡πà‡∏î‡∏µ - ‡∏´‡∏°‡∏ß‡∏Å‡πÅ‡∏Å‡πä‡∏õ 3 ‡∏™‡∏µ": 1,
            "‡∏´‡∏°‡∏ß‡∏Å‡πÅ‡∏Å‡πä‡∏ö‡∏ú‡πâ‡∏≤‡∏£‡πà‡∏° ‡πÄ‡∏î‡πá‡∏Å‡πÉ‡∏™‡πà‡πÑ‡∏î‡πâ ‡∏ú‡∏π‡πâ‡πÉ‡∏´‡∏ç‡πà‡πÉ‡∏™‡πà‡∏î‡∏µ - ‡∏´‡∏°‡∏ß‡∏Å‡πÅ‡∏Å‡πä‡∏õ‡∏™‡∏µ‡πÄ‡∏ó‡∏≤ - ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á": 1,
            "‡∏™‡∏ï‡∏¥‡∏Å‡πÄ‡∏Å‡∏≠‡∏£‡πå‡∏ï‡∏¥‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡∏£‡∏ñ ‡πÅ‡∏ö‡∏ö 1": 2,
            "‡∏™‡∏ï‡∏¥‡∏Å‡πÄ‡∏Å‡∏≠‡∏£‡πå‡∏ï‡∏¥‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡∏£‡∏ñ ‡πÅ‡∏ö‡∏ö 2": 2
          }
        }
      ];
    }

    // Search orders based on filters
    function searchOrders() {
      const batchFilter = document.getElementById('batchFilter').value;
      const nameSearch = document.getElementById('nameSearch').value.toLowerCase();
      const coreTeamOnly = document.getElementById('coreTeamFilter').checked;
      
      filteredOrders = allOrders.filter(order => {
        const matchesBatch = !batchFilter || order.batch === batchFilter;
        const matchesName = !nameSearch || order.contactName.toLowerCase().includes(nameSearch);
        const matchesCoreTeam = !coreTeamOnly || order.coreTeamAmount < 0;
        return matchesBatch && matchesName && matchesCoreTeam;
      });
      
      displayOrders(filteredOrders);
      
      const statusDiv = document.getElementById('statusMessage');
      if (filteredOrders.length === 0) {
        statusDiv.innerHTML = '<div class="error">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</div>';
      } else {
        statusDiv.innerHTML = '<div class="success">‡∏û‡∏ö‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ ' + filteredOrders.length + ' ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>';
      }
    }

    // Clear search filters
    function clearSearch() {
      document.getElementById('batchFilter').value = '';
      document.getElementById('nameSearch').value = '';
      document.getElementById('coreTeamFilter').checked = false;
      filteredOrders = allOrders;
      displayOrders(allOrders);
      document.getElementById('statusMessage').innerHTML = '';
    }



    // Display orders in the results section
    function displayOrders(orders) {
      const resultsDiv = document.getElementById('resultsSection');
      
      if (orders.length === 0) {
        resultsDiv.innerHTML = '<div class="no-results">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</div>';
        return;
      }
      
      let html = '';
      
      orders.forEach((order, index) => {
        html += `
          <div class="order-card">
            <div class="order-header">
              <div class="order-info">
                <div class="order-name">
                  ${order.contactName}
                  ${order.coreTeamAmount < 0 ? `<span class="core-team-badge">Core Team ${order.coreTeamAmount.toLocaleString()}</span>` : ''}
                </div>
                <div class="order-details">
                  ‡∏£‡∏∏‡πà‡∏ô: ${order.batch}${order.batchOther ? ' (' + order.batchOther + ')' : ''} | 
                  ‡πÄ‡∏ö‡∏≠‡∏£‡πå: ${order.phoneNumber} | 
                  ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${order.timestamp} | 
                  ‡∏™‡∏ï‡∏¥‡∏Å‡πÄ‡∏Å‡∏≠‡∏£‡πå‡∏ü‡∏£‡∏µ: ${order.freeStickers} ‡∏ä‡∏¥‡πâ‡∏ô
                  ${order.paymentSlipURL ? ` | <a href="${order.paymentSlipURL}" target="_blank" style="color: #059669; text-decoration: none; font-weight: 600;">üìÑ ‡∏î‡∏π‡∏™‡∏•‡∏¥‡∏õ</a>` : ''}
                </div>
              </div>
              <div class="order-total">${order.totalBaht.toLocaleString()} ‡∏ö‡∏≤‡∏ó</div>
            </div>
            <div class="order-items">
        `;
        
        // Display items with quantities
        Object.entries(order.items).forEach(([itemName, quantity]) => {
          if (quantity > 0) {
            const product = PRODUCT_CATALOG.find(p => p.name === itemName);
            const image = product ? product.image : 'standard.png';
            
            html += `
              <div class="item-card">
                <div class="item-header">
                  <img src="${image}" alt="${itemName}" class="item-image" onerror="this.src='standard.png'">
                  <div class="item-info">
                    <div class="item-name">${itemName}</div>
                    <div class="item-quantity">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: ${quantity} ‡∏ä‡∏¥‡πâ‡∏ô</div>
                  </div>
                </div>
              </div>
            `;
          }
        });
        
        html += `
            </div>
          </div>
        `;
      });
      
      resultsDiv.innerHTML = html;
    }

    // Initialize the page
    document.addEventListener('DOMContentLoaded', function() {
      // Load data from Google Sheets automatically when page loads
      loadDataFromSheets();
      
      // Add event listeners for real-time search
      document.getElementById('nameSearch').addEventListener('input', function() {
        if (this.value.length >= 2 || this.value.length === 0) {
          searchOrders();
        }
      });
      
      document.getElementById('batchFilter').addEventListener('change', searchOrders);
      document.getElementById('coreTeamFilter').addEventListener('change', searchOrders);
    });
  </script>
</body>
</html>
